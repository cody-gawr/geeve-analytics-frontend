import { __decorate, __param } from "tslib";
import { Injectable, Inject } from '@angular/core';
import { WindowRef } from './window-ref.service';
import { LazyStripeAPILoader, Status } from './api-loader.service';
import { STRIPE_PUBLISHABLE_KEY, STRIPE_OPTIONS } from '../interfaces/stripe';
import { StripeInstance } from './stripe-instance.class';
import { filter, map } from 'rxjs/operators';
var StripeService = /** @class */ (function () {
    function StripeService(key, options, loader, window) {
        this.key = key;
        this.options = options;
        this.loader = loader;
        this.window = window;
        if (key) {
            this.stripe = new StripeInstance(this.loader, this.window, key, options);
        }
    }
    StripeService.prototype.getStripeReference = function () {
        var _this = this;
        return this.loader.asStream().pipe(filter(function (status) { return status.loaded === true; }), map(function () { return _this.window.getNativeWindow().Stripe; }));
    };
    StripeService.prototype.getInstance = function () {
        return this.stripe.getInstance();
    };
    StripeService.prototype.setKey = function (key, options) {
        return this.changeKey(key, options);
    };
    StripeService.prototype.changeKey = function (key, options) {
        this.stripe = new StripeInstance(this.loader, this.window, key, options);
        return this.stripe;
    };
    StripeService.prototype.elements = function (options) {
        return this.stripe.elements(options);
    };
    StripeService.prototype.createToken = function (a, b) {
        return this.stripe.createToken(a, b);
    };
    StripeService.prototype.createSource = function (a, b) {
        return this.stripe.createSource(a, b);
    };
    StripeService.prototype.retrieveSource = function (source) {
        return this.stripe.retrieveSource(source);
    };
    StripeService.prototype.paymentRequest = function (options) {
        return this.stripe.paymentRequest(options);
    };
    StripeService.prototype.handleCardPayment = function (a, b, c) {
        return this.stripe.handleCardPayment(a, b, c);
    };
    StripeService.prototype.handleCardAction = function (a) {
        return this.stripe.handleCardAction(a);
    };
    StripeService.prototype.createPaymentMethod = function (a, b, c) {
        return this.stripe.createPaymentMethod(a, b, c);
    };
    StripeService.prototype.confirmPaymentIntent = function (a, b) {
        return this.stripe.confirmPaymentIntent(a, b);
    };
    StripeService.prototype.handleCardSetup = function (a, b, c) {
        return this.stripe.handleCardSetup(a, b, c);
    };
    StripeService.ctorParameters = function () { return [
        { type: String, decorators: [{ type: Inject, args: [STRIPE_PUBLISHABLE_KEY,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [STRIPE_OPTIONS,] }] },
        { type: LazyStripeAPILoader },
        { type: WindowRef }
    ]; };
    StripeService = __decorate([
        Injectable(),
        __param(0, Inject(STRIPE_PUBLISHABLE_KEY)),
        __param(1, Inject(STRIPE_OPTIONS))
    ], StripeService);
    return StripeService;
}());
export { StripeService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyaXBlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtc3RyaXBlLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL3N0cmlwZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUluRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDakQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRW5FLE9BQU8sRUFDTCxzQkFBc0IsRUFDdEIsY0FBYyxFQUdmLE1BQU0sc0JBQXNCLENBQUM7QUFjOUIsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBR3pELE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFXN0M7SUFHRSx1QkFDeUMsR0FBVyxFQUNuQixPQUFnQixFQUN4QyxNQUEyQixFQUMzQixNQUFpQjtRQUhlLFFBQUcsR0FBSCxHQUFHLENBQVE7UUFDbkIsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUN4QyxXQUFNLEdBQU4sTUFBTSxDQUFxQjtRQUMzQixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBRXhCLElBQUksR0FBRyxFQUFFO1lBQ1AsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLGNBQWMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1NBQzFFO0lBQ0gsQ0FBQztJQUVNLDBDQUFrQixHQUF6QjtRQUFBLGlCQUtDO1FBSkMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUksQ0FDaEMsTUFBTSxDQUFDLFVBQUMsTUFBYyxJQUFLLE9BQUEsTUFBTSxDQUFDLE1BQU0sS0FBSyxJQUFJLEVBQXRCLENBQXNCLENB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YUFBYSxDQStGekI7SUFBRCxvQkFBQztDQUFBLEFBL0ZELElBK0ZDO1NBL0ZZLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBXaW5kb3dSZWYgfSBmcm9tICcuL3dpbmRvdy1yZWYuc2VydmljZSc7XG5pbXBvcnQgeyBMYXp5U3RyaXBlQVBJTG9hZGVyLCBTdGF0dXMgfSBmcm9tICcuL2FwaS1sb2FkZXIuc2VydmljZSc7XG5cbmltcG9ydCB7XG4gIFNUUklQRV9QVUJMSVNIQUJMRV9LRVksXG4gIFNUUklQRV9PUFRJT05TLFxuICBPcHRpb25zLFxuICBTdHJpcGVKU1xufSBmcm9tICcuLi9pbnRlcmZhY2VzL3N0cmlwZSc7XG5pbXBvcnQgeyBFbGVtZW50IH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9lbGVtZW50JztcbmltcG9ydCB7IEVsZW1lbnRzLCBFbGVtZW50c09wdGlvbnMgfSBmcm9tICcuLi9pbnRlcmZhY2VzL2VsZW1lbnRzJztcbmltcG9ydCB7IFNvdXJjZURhdGEsIFNvdXJjZVJlc3VsdCwgU291cmNlUGFyYW1zIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9zb3VyY2VzJztcbmltcG9ydCB7XG4gIENhcmREYXRhT3B0aW9ucyxcbiAgVG9rZW5SZXN1bHQsXG4gIEFjY291bnQsXG4gIEFjY291bnREYXRhLFxuICBCYW5rQWNjb3VudCxcbiAgQmFua0FjY291bnREYXRhLFxuICBQaWlEYXRhLFxuICBQaWlcbn0gZnJvbSAnLi4vaW50ZXJmYWNlcy90b2tlbic7XG5pbXBvcnQgeyBTdHJpcGVJbnN0YW5jZSB9IGZyb20gJy4vc3RyaXBlLWluc3RhbmNlLmNsYXNzJztcbmltcG9ydCB7IFN0cmlwZVNlcnZpY2VJbnRlcmZhY2UgfSBmcm9tICcuL3N0cmlwZS1pbnN0YW5jZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUGF5bWVudFJlcXVlc3RPcHRpb25zIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wYXltZW50LXJlcXVlc3QnO1xuaW1wb3J0IHsgZmlsdGVyLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge1xuICBIYW5kbGVDYXJkUGF5bWVudE9wdGlvbnMsXG4gIENvbmZpcm1QYXltZW50SW50ZW50T3B0aW9ucyxcbiAgUGF5bWVudEludGVudFJlc3VsdCxcbiAgUGF5bWVudE1ldGhvZFJlc3VsdCxcbiAgUGF5bWVudE1ldGhvZERhdGFcbn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wYXltZW50LWludGVudCc7XG5pbXBvcnQgeyBDYXJkU2V0dXBSZXN1bHQgfSBmcm9tICcuLi9pbnRlcmZhY2VzL2NhcmQtc2V0dXAnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgU3RyaXBlU2VydmljZSBpbXBsZW1lbnRzIFN0cmlwZVNlcnZpY2VJbnRlcmZhY2Uge1xuICBwdWJsaWMgc3RyaXBlITogU3RyaXBlSW5zdGFuY2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChTVFJJUEVfUFVCTElTSEFCTEVfS0VZKSBwdWJsaWMga2V5OiBzdHJpbmcsXG4gICAgQEluamVjdChTVFJJUEVfT1BUSU9OUykgcHVibGljIG9wdGlvbnM6IE9wdGlvbnMsXG4gICAgcHVibGljIGxvYWRlcjogTGF6eVN0cmlwZUFQSUxvYWRlcixcbiAgICBwdWJsaWMgd2luZG93OiBXaW5kb3dSZWZcbiAgKSB7XG4gICAgaWYgKGtleSkge1xuICAgICAgdGhpcy5zdHJpcGUgPSBuZXcgU3RyaXBlSW5zdGFuY2UodGhpcy5sb2FkZXIsIHRoaXMud2luZG93LCBrZXksIG9wdGlvbnMpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRTdHJpcGVSZWZlcmVuY2UoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5sb2FkZXIuYXNTdHJlYW0oKS5waXBlKFxuICAgICAgZmlsdGVyKChzdGF0dXM6IFN0YXR1cykgPT4gc3RhdHVzLmxvYWRlZCA9PT0gdHJ1ZSksXG4gICAgICBtYXAoKCkgPT4gKHRoaXMud2luZG93LmdldE5hdGl2ZVdpbmRvdygpIGFzIGFueSkuU3RyaXBlKVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgZ2V0SW5zdGFuY2UoKTogU3RyaXBlSlMgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgcHVibGljIHNldEtleShrZXk6IHN0cmluZywgb3B0aW9ucz86IE9wdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy5jaGFuZ2VLZXkoa2V5LCBvcHRpb25zKTtcbiAgfVxuXG4gIHB1YmxpYyBjaGFuZ2VLZXkoa2V5OiBzdHJpbmcsIG9wdGlvbnM/OiBPcHRpb25zKSB7XG4gICAgdGhpcy5zdHJpcGUgPSBuZXcgU3RyaXBlSW5zdGFuY2UodGhpcy5sb2FkZXIsIHRoaXMud2luZG93LCBrZXksIG9wdGlvbnMpO1xuXG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlO1xuICB9XG5cbiAgcHVibGljIGVsZW1lbnRzKG9wdGlvbnM/OiBFbGVtZW50c09wdGlvbnMpOiBPYnNlcnZhYmxlPEVsZW1lbnRzPiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLmVsZW1lbnRzKG9wdGlvbnMpO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZVRva2VuKFxuICAgIGE6IEVsZW1lbnQgfCBBY2NvdW50IHwgQmFua0FjY291bnQgfCBQaWksXG4gICAgYjogQ2FyZERhdGFPcHRpb25zIHwgQWNjb3VudERhdGEgfCBCYW5rQWNjb3VudERhdGEgfCBQaWlEYXRhIHwgdW5kZWZpbmVkXG4gICk6IE9ic2VydmFibGU8VG9rZW5SZXN1bHQ+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUuY3JlYXRlVG9rZW4oYSwgYik7XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlU291cmNlKFxuICAgIGE6IEVsZW1lbnQgfCBTb3VyY2VEYXRhLFxuICAgIGI/OiBTb3VyY2VEYXRhIHwgdW5kZWZpbmVkXG4gICk6IE9ic2VydmFibGU8U291cmNlUmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLmNyZWF0ZVNvdXJjZShhLCBiKTtcbiAgfVxuXG4gIHB1YmxpYyByZXRyaWV2ZVNvdXJjZShzb3VyY2U6IFNvdXJjZVBhcmFtcyk6IE9ic2VydmFibGU8U291cmNlUmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnJldHJpZXZlU291cmNlKHNvdXJjZSk7XG4gIH1cblxuICBwdWJsaWMgcGF5bWVudFJlcXVlc3Qob3B0aW9uczogUGF5bWVudFJlcXVlc3RPcHRpb25zKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBheW1lbnRSZXF1ZXN0KG9wdGlvbnMpO1xuICB9XG5cbiAgcHVibGljIGhhbmRsZUNhcmRQYXltZW50KFxuICAgIGE6IHN0cmluZyxcbiAgICBiPzogRWxlbWVudCB8IEhhbmRsZUNhcmRQYXltZW50T3B0aW9ucyxcbiAgICBjPzogSGFuZGxlQ2FyZFBheW1lbnRPcHRpb25zIHwgdW5kZWZpbmVkXG4gICk6IE9ic2VydmFibGU8UGF5bWVudEludGVudFJlc3VsdD4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5oYW5kbGVDYXJkUGF5bWVudChhLCBiLCBjKTtcbiAgfVxuXG4gIHB1YmxpYyBoYW5kbGVDYXJkQWN0aW9uKGE6IHN0cmluZyk6IE9ic2VydmFibGU8UGF5bWVudEludGVudFJlc3VsdD4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5oYW5kbGVDYXJkQWN0aW9uKGEpO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZVBheW1lbnRNZXRob2QoXG4gICAgYTogc3RyaW5nLFxuICAgIGI6IEVsZW1lbnQsXG4gICAgYz86IFBheW1lbnRNZXRob2REYXRhXG4gICk6IE9ic2VydmFibGU8UGF5bWVudE1ldGhvZFJlc3VsdD4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5jcmVhdGVQYXltZW50TWV0aG9kKGEsIGIsIGMpO1xuICB9XG5cbiAgcHVibGljIGNvbmZpcm1QYXltZW50SW50ZW50KFxuICAgIGE6IHN0cmluZyxcbiAgICBiPzogQ29uZmlybVBheW1lbnRJbnRlbnRPcHRpb25zXG4gICk6IE9ic2VydmFibGU8UGF5bWVudEludGVudFJlc3VsdD4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5jb25maXJtUGF5bWVudEludGVudChhLCBiKTtcbiAgfVxuXG4gIHB1YmxpYyBoYW5kbGVDYXJkU2V0dXAoXG4gICAgYTogc3RyaW5nLFxuICAgIGI/OiBzdHJpbmcgfCBFbGVtZW50IHwgUGF5bWVudE1ldGhvZERhdGEsXG4gICAgYz86IFBheW1lbnRNZXRob2REYXRhXG4gICk6IE9ic2VydmFibGU8Q2FyZFNldHVwUmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLmhhbmRsZUNhcmRTZXR1cChhLCBiLCBjKTtcbiAgfVxufVxuIl19