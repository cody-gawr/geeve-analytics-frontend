!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-stripe",["exports","@angular/core","@angular/common","rxjs","rxjs/operators"],t):t((e=e||self)["ngx-stripe"]={},e.ng.core,e.ng.common,e.rxjs,e.rxjs.operators)}(this,(function(e,t,n,r,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function a(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function s(e,t){return function(n,r){t(n,r,e)}}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}var c=function(){function e(e){this.platformId=e}return e.prototype.getNativeWindow=function(){return n.isPlatformBrowser(this.platformId)?window:{}},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]},e=a([t.Injectable(),s(0,t.Inject(t.PLATFORM_ID))],e)}(),p=function(){function e(e){this.platformId=e}return e.prototype.getNativeDocument=function(){return n.isPlatformBrowser(this.platformId)?document:{}},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]},e=a([t.Injectable(),s(0,t.Inject(t.PLATFORM_ID))],e)}(),f=function(){function e(e,t,n){this.platformId=e,this.window=t,this.document=n,this.status=new r.BehaviorSubject({error:!1,loaded:!1,loading:!1})}return e.prototype.asStream=function(){return this.load(),this.status.asObservable()},e.prototype.isReady=function(){return this.status.getValue().loaded},e.prototype.load=function(){var e=this;if(!n.isPlatformServer(this.platformId)){var t=this.status.getValue();if(this.window.getNativeWindow().hasOwnProperty("Stripe"))this.status.next({error:!1,loaded:!0,loading:!1});else if(!t.loaded&&!t.loading){this.status.next(i(i({},t),{loading:!0}));var r=this.document.getNativeDocument().createElement("script");r.type="text/javascript",r.async=!0,r.defer=!0,r.src="https://js.stripe.com/v3/",r.onload=function(){e.status.next({error:!1,loaded:!0,loading:!1})},r.onerror=function(){e.status.next({error:!0,loaded:!1,loading:!1})},this.document.getNativeDocument().body.appendChild(r)}}},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]},{type:c},{type:p}]},e=a([t.Injectable(),s(0,t.Inject(t.PLATFORM_ID))],e)}(),l=new t.InjectionToken("Stripe Publishable Key"),d=new t.InjectionToken("Stripe Options");function h(e){return"type"in e}function y(e){return"bank_account"===e}function m(e){return"country"in e&&"currency"in e&&"routing_number"in e&&"account_number"in e&&("individual"===e.account_holder_type||"company"===e.account_holder_type||void 0===e.account_holder_type)}function v(e){return"pii"===e}function b(e){return"personal_id_number"in e}var g=function(){function e(e,t,n,i){var a=this;this.loader=e,this.window=t,this.key=n,this.options=i,this.stripe$=new r.BehaviorSubject(void 0),this.loader.asStream().pipe(o.filter((function(e){return!0===e.loaded})),o.first(),o.map((function(){return a.window.getNativeWindow().Stripe}))).subscribe((function(e){var t=a.options?e(a.key,a.options):e(a.key);a.stripe$.next(t)}))}return e.prototype.getInstance=function(){return this.stripe$.getValue()},e.prototype.elements=function(e){return this.stripe$.asObservable().pipe(o.filter((function(e){return Boolean(e)})),o.map((function(t){return t.elements(e)})),o.first())},e.prototype.createToken=function(e,t){return this.stripe$.asObservable().pipe(o.filter((function(e){return Boolean(e)})),o.switchMap((function(n){var o,i=n;return"account"===e&&((o=t).legal_entity||o.tos_shown_and_accepted)||y(e)&&m(t)||v(e)&&b(t),r.from(i.createToken(e,t))})),o.first())},e.prototype.createSource=function(e,t){return this.stripe$.asObservable().pipe(o.filter((function(e){return Boolean(e)})),o.switchMap((function(n){var o=n;return h(e)?r.from(o.createSource(e)):r.from(o.createSource(e,t))})),o.first())},e.prototype.retrieveSource=function(e){return this.stripe$.asObservable().pipe(o.filter((function(e){return Boolean(e)})),o.switchMap((function(t){var n=t;return r.from(n.retrieveSource(e))})),o.first())},e.prototype.paymentRequest=function(e){var t=this.getInstance();if(t)return t.paymentRequest(e)},e.prototype.handleCardPayment=function(e,t,n){return this.stripe$.asObservable().pipe(o.filter((function(e){return Boolean(e)})),o.switchMap((function(o){var i=o;return"type"in t?r.from(i.handleCardPayment(e,t)):r.from(i.handleCardPayment(e,t,n))})))},e.prototype.handleCardAction=function(e){return this.stripe$.asObservable().pipe(o.filter((function(e){return Boolean(e)})),o.switchMap((function(t){var n=t;return r.from(n.handleCardAction(e))})))},e.prototype.confirmPaymentIntent=function(e,t){return this.stripe$.asObservable().pipe(o.filter((function(e){return Boolean(e)})),o.switchMap((function(n){var o=n;return r.from(o.confirmPaymentIntent(e,t))})))},e.prototype.createPaymentMethod=function(e,t,n){return this.stripe$.asObservable().pipe(o.filter((function(e){return Boolean(e)})),o.switchMap((function(o){var i=o;return r.from(i.createPaymentMethod(e,t,n))})),o.first())},e.prototype.handleCardSetup=function(e,t,n){return this.stripe$.asObservable().pipe(o.filter((function(e){return Boolean(e)})),o.switchMap((function(o){var i,a=o;return(i=n)&&"type"in i?r.from(a.handleCardSetup(e,t,n)):r.from(a.handleCardSetup(e,t))})))},e}(),w=function(){function e(e,t,n,r){this.key=e,this.options=t,this.loader=n,this.window=r,e&&(this.stripe=new g(this.loader,this.window,e,t))}return e.prototype.getStripeReference=function(){var e=this;return this.loader.asStream().pipe(o.filter((function(e){return!0===e.loaded})),o.map((function(){return e.window.getNativeWindow().Stripe})))},e.prototype.getInstance=function(){return this.stripe.getInstance()},e.prototype.setKey=function(e,t){return this.changeKey(e,t)},e.prototype.changeKey=function(e,t){return this.stripe=new g(this.loader,this.window,e,t),this.stripe},e.prototype.elements=function(e){return this.stripe.elements(e)},e.prototype.createToken=function(e,t){return this.stripe.createToken(e,t)},e.prototype.createSource=function(e,t){return this.stripe.createSource(e,t)},e.prototype.retrieveSource=function(e){return this.stripe.retrieveSource(e)},e.prototype.paymentRequest=function(e){return this.stripe.paymentRequest(e)},e.prototype.handleCardPayment=function(e,t,n){return this.stripe.handleCardPayment(e,t,n)},e.prototype.handleCardAction=function(e){return this.stripe.handleCardAction(e)},e.prototype.createPaymentMethod=function(e,t,n){return this.stripe.createPaymentMethod(e,t,n)},e.prototype.confirmPaymentIntent=function(e,t){return this.stripe.confirmPaymentIntent(e,t)},e.prototype.handleCardSetup=function(e,t,n){return this.stripe.handleCardSetup(e,t,n)},e.ctorParameters=function(){return[{type:String,decorators:[{type:t.Inject,args:[l]}]},{type:void 0,decorators:[{type:t.Inject,args:[d]}]},{type:f},{type:c}]},e=a([t.Injectable(),s(0,t.Inject(l)),s(1,t.Inject(d))],e)}(),I=function(){function e(e,t,n,r){this.baseKey=e,this.baseOptions=t,this.loader=n,this.window=r}return e.prototype.create=function(e,t){return new g(this.loader,this.window,e,t)},e.ctorParameters=function(){return[{type:String,decorators:[{type:t.Inject,args:[l]}]},{type:String,decorators:[{type:t.Inject,args:[d]}]},{type:f},{type:c}]},e=a([t.Injectable(),s(0,t.Inject(l)),s(1,t.Inject(d))],e)}(),S=function(){function e(e){this.stripeService=e,this.card=new t.EventEmitter,this.on=new t.EventEmitter,this.options$=new r.BehaviorSubject({}),this.elementsOptions$=new r.BehaviorSubject({}),this.stripe$=new r.BehaviorSubject(null)}return Object.defineProperty(e.prototype,"options",{set:function(e){this.options$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementsOptions",{set:function(e){this.elementsOptions$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stripe",{set:function(e){this.stripe$.next(e)},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){var e=this,t=r.combineLatest(this.elementsOptions$.asObservable(),this.stripe$.asObservable()).pipe(o.switchMap((function(t){var n=u(t,2),r=n[0],o=n[1];return o?Object.keys(r).length>0?o.elements(r):o.elements():Object.keys(r).length>0?e.stripeService.elements(r):e.stripeService.elements()})));r.combineLatest(t,this.options$.asObservable().pipe(o.filter((function(e){return Boolean(e)})))).subscribe((function(t){var n=u(t,2),r=n[0],o=n[1];e.element=r.create("card",o),e.element.on("blur",(function(t){return e.on.emit({event:t,type:"blur"})})),e.element.on("change",(function(t){return e.on.emit({event:t,type:"change"})})),e.element.on("click",(function(t){return e.on.emit({event:t,type:"click"})})),e.element.on("focus",(function(t){return e.on.emit({event:t,type:"focus"})})),e.element.on("ready",(function(t){return e.on.emit({event:t,type:"ready"})})),e.element.mount(e.stripeCard.nativeElement),e.card.emit(e.element)}))},e.prototype.getCard=function(){return this.element},e.ctorParameters=function(){return[{type:w}]},a([t.Output()],e.prototype,"card",void 0),a([t.Output()],e.prototype,"on",void 0),a([t.ViewChild("stripeCard")],e.prototype,"stripeCard",void 0),a([t.Input()],e.prototype,"options",null),a([t.Input()],e.prototype,"elementsOptions",null),a([t.Input()],e.prototype,"stripe",null),e=a([t.Component({selector:"ngx-stripe-card",template:'\n    <div class="field" #stripeCard></div>\n  '})],e)}(),j=function(){function e(){}var n;return n=e,e.forRoot=function(e,t){return{ngModule:n,providers:[f,w,I,c,p,{provide:l,useValue:e},{provide:d,useValue:t}]}},e.forChild=function(e,t){return{ngModule:n,providers:[f,w,I,c,p,{provide:l,useValue:e},{provide:d,useValue:t}]}},e=n=a([t.NgModule({declarations:[S],exports:[S]})],e)}();e.DocumentRef=p,e.LazyStripeAPILoader=f,e.NgxStripeModule=j,e.STRIPE_OPTIONS=d,e.STRIPE_PUBLISHABLE_KEY=l,e.StripeCardComponent=S,e.StripeFactoryService=I,e.StripeInstance=g,e.StripeService=w,e.WindowRef=c,e.isBankAccount=y,e.isBankAccountData=m,e.isPii=v,e.isPiiData=b,e.isSourceData=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-stripe.umd.min.js.map