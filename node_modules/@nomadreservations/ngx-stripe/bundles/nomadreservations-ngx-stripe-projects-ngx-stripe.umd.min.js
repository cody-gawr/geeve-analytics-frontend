!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@angular/common"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@nomadreservations/ngx-stripe/projects/ngx-stripe",["exports","@angular/core","rxjs","@angular/common","rxjs/operators"],t):t(((e=e||self).nomadreservations=e.nomadreservations||{},e.nomadreservations["ngx-stripe"]=e.nomadreservations["ngx-stripe"]||{},e.nomadreservations["ngx-stripe"].projects=e.nomadreservations["ngx-stripe"].projects||{},e.nomadreservations["ngx-stripe"].projects["ngx-stripe"]={}),e.ng.core,e.rxjs,e.ng.common,e.rxjs.operators)}(this,function(e,t,r,n,o){"use strict";var i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s}function a(e,t){return function(r,n){t(r,n,e)}}function p(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e){return"type"in e}var u=new t.InjectionToken("Stripe Publishable Key"),l=new t.InjectionToken("Stripe Options");function d(e){return"bank_account"===e}function f(e){return"country"in e&&"currency"in e&&"routing_number"in e&&"account_number"in e&&"account_holder_name"in e&&"account_holder_type"in e&&("individual"===e.account_holder_type||"company"===e.account_holder_type)}function m(e){return"pii"===e}function h(e){return"personal_id_number"in e}var y=function(){function e(e){this.platformId=e}return Object.defineProperty(e.prototype,"isBrowser",{get:function(){return n.isPlatformBrowser(this.platformId)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isServer",{get:function(){return n.isPlatformServer(this.platformId)},enumerable:!0,configurable:!0}),e=s([t.Injectable(),a(0,t.Inject(t.PLATFORM_ID)),p("design:paramtypes",[Object])],e)}(),g=function(){function e(e){this._platform=e}return e.prototype.getNativeDocument=function(){return this._platform.isBrowser?document:{}},e=s([t.Injectable(),p("design:paramtypes",[y])],e)}(),v=function(){function e(e){this._platform=e}return e.prototype.getNativeWindow=function(){return this._platform.isBrowser?window:{}},e=s([t.Injectable(),p("design:paramtypes",[y])],e)}(),b=function(){function e(e,t,n){this.window=e,this.document=t,this._platform=n,this.status=new r.BehaviorSubject({error:!1,loaded:!1,loading:!1})}return e.prototype.asStream=function(){return this.load(),this.status.asObservable()},e.prototype.isReady=function(){return this.status.getValue().loaded},e.prototype.load=function(){var e=this;if(!this._platform.isServer)if(this.window.getNativeWindow().hasOwnProperty("Stripe"))this.status.next({error:!1,loaded:!0,loading:!1});else if(!this.status.getValue().loaded&&!this.status.getValue().loading){this.status.next(i({},this.status.getValue(),{loading:!0}));var t=this.document.getNativeDocument().createElement("script");t.type="text/javascript",t.async=!0,t.defer=!0,t.src="https://js.stripe.com/v3/",t.onload=function(){e.status.next({error:!1,loaded:!0,loading:!1})},t.onerror=function(){e.status.next({error:!0,loaded:!1,loading:!1})},this.document.getNativeDocument().body.appendChild(t)}},e=s([t.Injectable(),p("design:paramtypes",[v,g,y])],e)}(),j=function(){function e(e,t,n,i,s){this.key=e,this.options=t,this.loader=n,this.window=i,this._platform=s,this.stripeChanged$=new r.ReplaySubject,this.stripe={},this.changeKey(this.key,this.options).pipe(o.take(1)).subscribe(function(){})}return e.prototype.changeKey=function(e,t){var r=this,n=this.loader.asStream().pipe(o.filter(function(e){return!0===e.loaded}),o.map(function(){if(r.window.getNativeWindow()){var n=r.window.getNativeWindow().Stripe;return e&&(r.stripe=t?n(e,t):n(e),r.stripeChanged$.next(r.stripe)),r.stripe}}),o.publishLast(),o.refCount());return n.subscribe(),n},e.prototype.elements=function(e){var t=this;return this.stripeChanged$.pipe(o.map(function(){return t.stripe.elements(e)}))},e.prototype.createToken=function(e,t){return d(e)&&f(t)?r.from(this.stripe.createToken(e,t)):(m(e)&&h(t),r.from(this.stripe.createToken(e,t)))},e.prototype.handleCardSetup=function(e,t,n){return r.from(this.stripe.handleCardSetup(e,t,n))},e.prototype.createSource=function(e,t){return c(e)?r.from(this.stripe.createSource(e)):r.from(this.stripe.createSource(e,t))},e.prototype.retrieveSource=function(e){return r.from(this.stripe.retrieveSource(e))},e=s([t.Injectable(),a(0,t.Inject(u)),a(1,t.Inject(l)),p("design:paramtypes",[String,Object,b,v,y])],e)}(),O=function(){function e(e){this.stripeService=e,this.change=new t.EventEmitter,this.complete=new t.EventEmitter,this.error=new t.EventEmitter,this.options$=new r.BehaviorSubject({}),this.elementsOptions$=new r.BehaviorSubject({})}return Object.defineProperty(e.prototype,"options",{set:function(e){this.options$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementsOptions",{set:function(e){this.elementsOptions$.next(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this,t=this.elementsOptions$.asObservable().pipe(o.switchMap(function(t){return Object.keys(t).length>0?e.stripeService.elements(t):e.stripeService.elements()}));r.combineLatest(t,this.options$.asObservable().pipe(o.filter(function(e){return Boolean(e)}))).subscribe(function(t){var r=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}(t,2),n=r[0],o=r[1];e.card&&(e.element=n.create("card",o),e.element.mount(e.card.nativeElement),e.element.on("change",function(t){e.change.emit({card:t,element:e.element}),t.complete&&e.complete.emit({card:t,element:e.element}),t.error&&e.error.emit(t.error)}))})},e.prototype.getCard=function(){return this.element},s([t.Output(),p("design:type",Object)],e.prototype,"change",void 0),s([t.Output(),p("design:type",Object)],e.prototype,"complete",void 0),s([t.Output(),p("design:type",Object)],e.prototype,"error",void 0),s([t.ViewChild("card"),p("design:type",t.ElementRef)],e.prototype,"card",void 0),s([t.Input(),p("design:type",Object),p("design:paramtypes",[Object])],e.prototype,"options",null),s([t.Input(),p("design:type",Object),p("design:paramtypes",[Object])],e.prototype,"elementsOptions",null),e=s([t.Component({selector:"ngx-stripe-card",template:'<div class="field" #card></div>'}),p("design:paramtypes",[j])],e)}(),S=function(){function e(){}var r;return r=e,e.forRoot=function(e,t){return{ngModule:r,providers:[b,j,y,v,g,{provide:u,useValue:e},{provide:l,useValue:t}]}},e=r=s([t.NgModule({declarations:[O],exports:[O]})],e)}();e.DocumentRef=g,e.LazyStripeAPILoader=b,e.NgxStripeModule=S,e.PlatformService=y,e.STRIPE_OPTIONS=l,e.STRIPE_PUBLISHABLE_KEY=u,e.StripeCardComponent=O,e.StripeService=j,e.WindowRef=v,e.isBankAccount=d,e.isBankAccountData=f,e.isPii=m,e.isPiiData=h,e.isSourceData=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=nomadreservations-ngx-stripe-projects-ngx-stripe.umd.min.js.map