!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@angular/common"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@nomadreservations/ngx-stripe",["exports","@angular/core","rxjs","@angular/common","rxjs/operators"],t):t(((e=e||self).nomadreservations=e.nomadreservations||{},e.nomadreservations["ngx-stripe"]={}),e.ng.core,e.rxjs,e.ng.common,e.rxjs.operators)}(this,function(e,t,n,r,o){"use strict";var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function a(e,t){return function(n,r){t(n,r,e)}}function c(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function u(e){return"type"in e}var p=new t.InjectionToken("Stripe Publishable Key"),l=new t.InjectionToken("Stripe Options");function f(e){return"bank_account"===e}function d(e){return"country"in e&&"currency"in e&&"routing_number"in e&&"account_number"in e&&"account_holder_name"in e&&"account_holder_type"in e&&("individual"===e.account_holder_type||"company"===e.account_holder_type)}function m(e){return"pii"===e}function h(e){return"personal_id_number"in e}var y=function(){function e(e){this.platformId=e}return Object.defineProperty(e.prototype,"isBrowser",{get:function(){return r.isPlatformBrowser(this.platformId)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isServer",{get:function(){return r.isPlatformServer(this.platformId)},enumerable:!0,configurable:!0}),e=s([t.Injectable(),a(0,t.Inject(t.PLATFORM_ID)),c("design:paramtypes",[Object])],e)}(),g=function(){function e(e){this._platform=e}return e.prototype.getNativeDocument=function(){return this._platform.isBrowser?document:{}},e=s([t.Injectable(),c("design:paramtypes",[y])],e)}(),v=function(){function e(e){this._platform=e}return e.prototype.getNativeWindow=function(){return this._platform.isBrowser?window:{}},e=s([t.Injectable(),c("design:paramtypes",[y])],e)}(),b=function(){function e(e,t,r){this.window=e,this.document=t,this._platform=r,this.status=new n.BehaviorSubject({error:!1,loaded:!1,loading:!1})}return e.prototype.asStream=function(){return this.load(),this.status.asObservable()},e.prototype.isReady=function(){return this.status.getValue().loaded},e.prototype.load=function(){var e=this;if(!this._platform.isServer)if(this.window.getNativeWindow().hasOwnProperty("Stripe"))this.status.next({error:!1,loaded:!0,loading:!1});else if(!this.status.getValue().loaded&&!this.status.getValue().loading){this.status.next(i({},this.status.getValue(),{loading:!0}));var t=this.document.getNativeDocument().createElement("script");t.type="text/javascript",t.async=!0,t.defer=!0,t.src="https://js.stripe.com/v3/",t.onload=function(){e.status.next({error:!1,loaded:!0,loading:!1})},t.onerror=function(){e.status.next({error:!0,loaded:!1,loading:!1})},this.document.getNativeDocument().body.appendChild(t)}},e=s([t.Injectable(),c("design:paramtypes",[v,g,y])],e)}(),j=function(){function e(e,t,r,i,s){this.key=e,this.options=t,this.loader=r,this.window=i,this._platform=s,this.stripeChanged$=new n.ReplaySubject,this.stripe={},this.changeKey(this.key,this.options).pipe(o.take(1)).subscribe(function(){})}return e.prototype.changeKey=function(e,t){var n=this,r=this.loader.asStream().pipe(o.filter(function(e){return!0===e.loaded}),o.map(function(){if(n.window.getNativeWindow()){var r=n.window.getNativeWindow().Stripe;return e&&(n.stripe=t?r(e,t):r(e),n.stripeChanged$.next(n.stripe)),n.stripe}}),o.publishLast(),o.refCount());return r.subscribe(),r},e.prototype.elements=function(e){var t=this;return this.stripeChanged$.pipe(o.map(function(){return t.stripe.elements(e)}))},e.prototype.createToken=function(e,t){return f(e)&&d(t)?n.from(this.stripe.createToken(e,t)):(m(e)&&h(t),n.from(this.stripe.createToken(e,t)))},e.prototype.handleCardSetup=function(e,t,r){return n.from(this.stripe.handleCardSetup(e,t,r))},e.prototype.createSource=function(e,t){return u(e)?n.from(this.stripe.createSource(e)):n.from(this.stripe.createSource(e,t))},e.prototype.retrieveSource=function(e){return n.from(this.stripe.retrieveSource(e))},e=s([t.Injectable(),a(0,t.Inject(p)),a(1,t.Inject(l)),c("design:paramtypes",[String,Object,b,v,y])],e)}(),O=function(){function e(e){this.stripeService=e,this.change=new t.EventEmitter,this.complete=new t.EventEmitter,this.error=new t.EventEmitter,this.options$=new n.BehaviorSubject({}),this.elementsOptions$=new n.BehaviorSubject({})}return Object.defineProperty(e.prototype,"options",{set:function(e){this.options$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementsOptions",{set:function(e){this.elementsOptions$.next(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this,t=this.elementsOptions$.asObservable().pipe(o.switchMap(function(t){return Object.keys(t).length>0?e.stripeService.elements(t):e.stripeService.elements()}));n.combineLatest(t,this.options$.asObservable().pipe(o.filter(function(e){return Boolean(e)}))).subscribe(function(t){var n=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}(t,2),r=n[0],o=n[1];e.card&&(e.element=r.create("card",o),e.element.mount(e.card.nativeElement),e.element.on("change",function(t){e.change.emit({card:t,element:e.element}),t.complete&&e.complete.emit({card:t,element:e.element}),t.error&&e.error.emit(t.error)}))})},e.prototype.getCard=function(){return this.element},s([t.Output(),c("design:type",Object)],e.prototype,"change",void 0),s([t.Output(),c("design:type",Object)],e.prototype,"complete",void 0),s([t.Output(),c("design:type",Object)],e.prototype,"error",void 0),s([t.ViewChild("card"),c("design:type",t.ElementRef)],e.prototype,"card",void 0),s([t.Input(),c("design:type",Object),c("design:paramtypes",[Object])],e.prototype,"options",null),s([t.Input(),c("design:type",Object),c("design:paramtypes",[Object])],e.prototype,"elementsOptions",null),e=s([t.Component({selector:"ngx-stripe-card",template:'<div class="field" #card></div>'}),c("design:paramtypes",[j])],e)}(),S=function(){function e(){}var n;return n=e,e.forRoot=function(e,t){return{ngModule:n,providers:[b,j,y,v,g,{provide:p,useValue:e},{provide:l,useValue:t}]}},e=n=s([t.NgModule({declarations:[O],exports:[O]})],e)}();e.DocumentRef=g,e.LazyStripeAPILoader=b,e.NgxStripeModule=S,e.PlatformService=y,e.STRIPE_OPTIONS=l,e.STRIPE_PUBLISHABLE_KEY=p,e.StripeCardComponent=O,e.StripeService=j,e.WindowRef=v,e.isBankAccount=f,e.isBankAccountData=d,e.isPii=m,e.isPiiData=h,e.isSourceData=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=nomadreservations-ngx-stripe.umd.min.js.map